#include "../Printer.h"
#include "../CharConv.h"
#include "../HashMap.h"
#include "../String.h"
#include "../Vector.h"
#include "../Enumerate.h"
#include "../JSONParser.h"
#include "../Array.h"
#include "../Chrono.h"
#include "../Assertion.h"
#include <benchmark/benchmark.h>
#include <inttypes.h>

using namespace ARLib;
static void BM_PrintfARLib(benchmark::State& state) {
    char buf[1024]{};
    for (auto _ : state) {
        double val              = 1234.1234;
        const char* s           = "my name is alessio";
        int hex                 = 0x50;
        ARLib::int64_t int64val = INT64_MAX;
        ARLib::sprintf(buf, "Hello World %+10.4f %% %s %#02o %#02I64X %%\n", val, s, hex, int64val);
        benchmark::ClobberMemory();
    }
}
static void BM_PrintfStd(benchmark::State& state) {
    char buf[1024]{};
    for (auto _ : state) {
        double val              = 1234.1234;
        const char* s           = "my name is alessio";
        int hex                 = 0x50;
        ARLib::int64_t int64val = INT64_MAX;
        ::sprintf(buf, "Hello World %+10.4f %% %s %#02o %#02" PRIX64 " %%\n", val, s, hex, int64val);
        benchmark::ClobberMemory();
    }
}
static void BM_JSONParsing(benchmark::State& state) {
    const Array names{ "jsons/9c.json",
                       "jsons/albatoss.json",
                       "jsons/AmazingFlyingPuntinChuck.json",
                       "jsons/AngryStar.json",
                       "jsons/AngrySun-SMB3.json",
                       "jsons/AngrySun-SMM2.json",
                       "jsons/AnnoyingBee.json",
                       "jsons/anyspritegen.json",
                       "jsons/arrowlift.json",
                       "jsons/atomicshroom.json",
                       "jsons/BabyYoshi.json",
                       "jsons/Balloon_dis.json",
                       "jsons/banzai_bill_9F.json",
                       "jsons/banzai_bill_forest.json",
                       "jsons/beet_platform.json",
                       "jsons/BigSpike.json",
                       "jsons/BigTimedLift.json",
                       "jsons/big_boy_urchin.json",
                       "jsons/BillBomber.json",
                       "jsons/BloodyGrinder.json",
                       "jsons/blooper.json",
                       "jsons/BlueBoomerang.json",
                       "jsons/BobOmbBLK.json",
                       "jsons/Bobomb_dis.json",
                       "jsons/bomb.json",
                       "jsons/bomb_bro.json",
                       "jsons/BooBlockButActual.json",
                       "jsons/BoomBoom.json",
                       "jsons/boomerang.json",
                       "jsons/BoomerangBro.json",
                       "jsons/boomerang_bro.json",
                       "jsons/Boom_Guy.json",
                       "jsons/boospEEEN.json",
                       "jsons/BooStreamChase.json",
                       "jsons/boo_door.json",
                       "jsons/boo_door_castle.json",
                       "jsons/bopping_toady.json",
                       "jsons/bouncing_spiny_egg.json",
                       "jsons/Bowling Ball.json",
                       "jsons/Bowser Fire.json",
                       "jsons/BowserBlade(SP4).json",
                       "jsons/BowserBlade.json",
                       "jsons/BowserFist.json",
                       "jsons/BowserStatue.json",
                       "jsons/bowser_bowling_ball_A1(SP2).json",
                       "jsons/bowser_bowling_ball_A1(SP4).json",
                       "jsons/bowser_bowling_ball_A1.json",
                       "jsons/BulletBillGen_D5.json",
                       "jsons/bullet_bill_1C.json",
                       "jsons/burnerh.json",
                       "jsons/burnerv.json",
                       "jsons/buzzy-beetle-dis.json",
                       "jsons/buzz_bomber.json",
                       "jsons/CandleFlameSpawner.json",
                       "jsons/carrot_top_lift_B7+B8.json",
                       "jsons/cb_tnt.json",
                       "jsons/celeste_block.json",
                       "jsons/charging_spiny.json",
                       "jsons/chuck.json",
                       "jsons/clawgrip.json",
                       "jsons/clawgrip_rock.json",
                       "jsons/Claymore.json",
                       "jsons/climbing_net_door.json",
                       "jsons/clusterspawn.json",
                       "jsons/coin.json",
                       "jsons/ColorYoshi.json",
                       "jsons/condbulletshooter.json",
                       "jsons/ConditionalSpawner.json",
                       "jsons/ConditionalSpawnerOnce.json",
                       "jsons/cooligan.json",
                       "jsons/cooliganshooter.json",
                       "jsons/Countbomb.json",
                       "jsons/crab.json",
                       "jsons/CustomisableBoomBoom.json",
                       "jsons/customizable-buzzy-beetle.json",
                       "jsons/customizable-scale-platform.json",
                       "jsons/CustomLemmyWendy.json",
                       "jsons/custom_green_bubble.json",
                       "jsons/custom_line_rope.json",
                       "jsons/custom_scale.json",
                       "jsons/C_Ball_Bro.json",
                       "jsons/C_Bomb_Bro.json",
                       "jsons/C_Boomerang_Bro.json",
                       "jsons/C_Braze_Bro.json",
                       "jsons/C_Bullet_Bro.json",
                       "jsons/C_Curve_Bro.json",
                       "jsons/C_Elec_Bro.json",
                       "jsons/C_Fire_Bro.json",
                       "jsons/C_Flame_Bro.json",
                       "jsons/C_Frost_Bro.json",
                       "jsons/C_Hammer_Bro.json",
                       "jsons/C_Ice_Bro.json",
                       "jsons/C_Mix_Bro.json",
                       "jsons/C_Shell_Bro.json",
                       "jsons/C_Sledge_Bro.json",
                       "jsons/DancingSpearGuy.json",
                       "jsons/DemonHead.json",
                       "jsons/diagonal_green_beans.json",
                       "jsons/diag_down_bomb_shooter.json",
                       "jsons/diag_up_bomb_shooter.json",
                       "jsons/DirectionalPlatform.json",
                       "jsons/DirectionalPlatform2.json",
                       "jsons/DirectionalPlatform3.json",
                       "jsons/DivisibleBoo.json",
                       "jsons/door.json",
                       "jsons/Eerie.json",
                       "jsons/EerieBlock.json",
                       "jsons/electricity.json",
                       "jsons/electricity_castle.json",
                       "jsons/electricity_free.json",
                       "jsons/elevator_fast.json",
                       "jsons/elevator_slow.json",
                       "jsons/exanim_shooter.json",
                       "jsons/ExBytesExtender.json",
                       "jsons/exploding_block.json",
                       "jsons/exploding_bowser_statue.json",
                       "jsons/ExplosiveBlurp.json",
                       "jsons/ExplosiveDolphin_Horz.json",
                       "jsons/ExplosiveDolphin_Vert.json",
                       "jsons/ExplosiveUrchin.json",
                       "jsons/falling_block(SP3).json",
                       "jsons/falling_block.json",
                       "jsons/fatpiranhaplant.json",
                       "jsons/FireBar.json",
                       "jsons/FireBar_Shiftable.json",
                       "jsons/FireBro.json",
                       "jsons/firechomp.json",
                       "jsons/firechompflame.json",
                       "jsons/Firefly.json",
                       "jsons/firestalk.json",
                       "jsons/fire_snake.json",
                       "jsons/fire_snake_athletic.json",
                       "jsons/fire_snake_free.json",
                       "jsons/Fire_sumo_lightning.json",
                       "jsons/fishin_boo.json",
                       "jsons/fishin_boo_boss.json",
                       "jsons/floating_platform_5B+5C.json",
                       "jsons/flurry.json",
                       "jsons/FlyingBabyYoshi.json",
                       "jsons/FlyingCloud.json",
                       "jsons/flyingitems.json",
                       "jsons/flyingkeyhole.json",
                       "jsons/FlyingOnOff.json",
                       "jsons/FlyingPlatform.json",
                       "jsons/FlyingQuestionBlock.json",
                       "jsons/flying_hammer_bro.json",
                       "jsons/flying_rock_platforms_56+58.json",
                       "jsons/flying_rope.json",
                       "jsons/fly_guy.json",
                       "jsons/FryGuy.json",
                       "jsons/ghost-shell.json",
                       "jsons/ghost_guy.json",
                       "jsons/GiantGrinder.json",
                       "jsons/GiantJumpingPlant(SP2).json",
                       "jsons/GiantJumpingPlant.json",
                       "jsons/GiantSpring.json",
                       "jsons/giant_blue_koopa.json",
                       "jsons/giant_buzzy_beetle.json",
                       "jsons/giant_fire_swooper.json",
                       "jsons/giant_goomba.json",
                       "jsons/giant_goomba_modify.json",
                       "jsons/giant_green_koopa.json",
                       "jsons/Giant_Ninji.json",
                       "jsons/Giant_Ninji_Fort.json",
                       "jsons/giant_parakoopa.json",
                       "jsons/giant_red_koopa.json",
                       "jsons/giant_swooper.json",
                       "jsons/giant_yellow_koopa.json",
                       "jsons/GoalFlagpole.json",
                       "jsons/Goomba.json",
                       "jsons/goomba_jump.json",
                       "jsons/Goombud.json",
                       "jsons/green_bubble.json",
                       "jsons/GrinderKiller.json",
                       "jsons/grinder_bridge.json",
                       "jsons/GroundSwooper.json",
                       "jsons/growing_vine.json",
                       "jsons/HammerBro.json",
                       "jsons/hammer_bro.json",
                       "jsons/homing_horizontal_thwomp.json",
                       "jsons/horizontal_bomb_shooter.json",
                       "jsons/IceBro.json",
                       "jsons/iggy_boss.json",
                       "jsons/InfoBox.json",
                       "jsons/InfoBox32x32.json",
                       "jsons/InfoBox_exploding.json",
                       "jsons/ink.json",
                       "jsons/InvincibleShell.json",
                       "jsons/invincible_shellboard.json",
                       "jsons/jumping_piranha_plants.json",
                       "jsons/keyhole.json",
                       "jsons/Killer.json",
                       "jsons/KoopaShellBlue.json",
                       "jsons/KoopaShellGreen.json",
                       "jsons/KoopaShellGreenSpecial.json",
                       "jsons/KoopaShellRed.json",
                       "jsons/KoopaShellYellow.json",
                       "jsons/Kun.json",
                       "jsons/LargeOrb.json",
                       "jsons/Layer3CandleFlameSpawner.json",
                       "jsons/leaf.json",
                       "jsons/lightning.json",
                       "jsons/light_sparkle.json",
                       "jsons/Lineguided_AnySprite.json",
                       "jsons/mechakoopa_but_awesome.json",
                       "jsons/mechiggy.json",
                       "jsons/mechiggy_forest.json",
                       "jsons/mega_mole_BF.json",
                       "jsons/MeterSprite.json",
                       "jsons/Milde.json",
                       "jsons/MMGate.json",
                       "jsons/Moneybags.json",
                       "jsons/MontyMoleCUSTOM.json",
                       "jsons/MontyMoleDis.json",
                       "jsons/MontyMolePile.json",
                       "jsons/MultiBounceShellBlue.json",
                       "jsons/MultiBounceShellGreen.json",
                       "jsons/MultiBounceShellRed.json",
                       "jsons/MultiBounceShellYellow.json",
                       "jsons/multi_bill_cannon.json",
                       "jsons/MuncherBridge.json",
                       "jsons/NetSparky.json",
                       "jsons/npc.json",
                       "jsons/numbered_platform.json",
                       "jsons/PanelMonster.json",
                       "jsons/panser_fire.json",
                       "jsons/ParachuteSpiny.json",
                       "jsons/parachute_thwomp.json",
                       "jsons/ParaGoomba.json",
                       "jsons/ParaGoombaBomber.json",
                       "jsons/ParaGoombaBomberAlwaysHover.json",
                       "jsons/pendu_disc_good.json",
                       "jsons/pendu_disc_old.json",
                       "jsons/PileDriverMicroGoomba.json",
                       "jsons/pinkie.json",
                       "jsons/PipeDwellingBowserStatue.json",
                       "jsons/PipeLakitu.json",
                       "jsons/pipe_gen_right_left.json",
                       "jsons/pipe_gen_up_down.json",
                       "jsons/pipe_panser_dwell.json",
                       "jsons/pipe_panser_periodic.json",
                       "jsons/piranha_firespit.json",
                       "jsons/PlusMinusClock.json",
                       "jsons/pogotoad_different_heights.json",
                       "jsons/pogotoad_normal.json",
                       "jsons/PoisonMushroom.json",
                       "jsons/pokey_70.json",
                       "jsons/pokey_football.json",
                       "jsons/POW_dis.json",
                       "jsons/PressureGate.json",
                       "jsons/PressureSwitch.json",
                       "jsons/prickly_goomba.json",
                       "jsons/projectile.json",
                       "jsons/r-eject.json",
                       "jsons/regen_pokey.json",
                       "jsons/regen_rex.json",
                       "jsons/reverse_donut.json",
                       "jsons/rex_AB.json",
                       "jsons/rex_SP3.json",
                       "jsons/rotating_platform.json",
                       "jsons/rotating_sprites_spawner.json",
                       "jsons/sakasa.json",
                       "jsons/SBCDiamond.json",
                       "jsons/SBCEllipse.json",
                       "jsons/SBCRectangle.json",
                       "jsons/SBCRegularPolygon.json",
                       "jsons/scale-platform-dis.json",
                       "jsons/scale.json",
                       "jsons/SeaPokey.json",
                       "jsons/shark.json",
                       "jsons/shell_bro.json",
                       "jsons/shooter-simple.json",
                       "jsons/shooter.json",
                       "jsons/shy_guy_yi_randpal.json",
                       "jsons/shy_guy_yi_setpal.json",
                       "jsons/silius_shooter.json",
                       "jsons/SledgeBro.json",
                       "jsons/SleepyGoomba.json",
                       "jsons/sleepy_bob_omb.json",
                       "jsons/Sleepy_Boo.json",
                       "jsons/sloped_mega_mole.json",
                       "jsons/sloped_mega_mole_flipnormal.json",
                       "jsons/SMB2Panser.json",
                       "jsons/SMB2POW.json",
                       "jsons/SMBGoalFlagpole.json",
                       "jsons/smm2_spike.json",
                       "jsons/SMM_PSwitch.json",
                       "jsons/sparky_hothead_A5+A6.json",
                       "jsons/SpecialBerry.json",
                       "jsons/spikeball.json",
                       "jsons/spike_chuck.json",
                       "jsons/spike_chuck_playable.json",
                       "jsons/Spinblock_dynamic.json",
                       "jsons/SpinFloat.json",
                       "jsons/splitting_giant_goomba.json",
                       "jsons/splitting_mega_goomba.json",
                       "jsons/spriteoffsetter.json",
                       "jsons/StationarySpiny.json",
                       "jsons/StationarySwooper.json",
                       "jsons/SumoChuck.json",
                       "jsons/sumo_brother_9A.json",
                       "jsons/sumo_lightning_2B.json",
                       "jsons/sumo_lightning_Custom.json",
                       "jsons/sunshine_blooper.json",
                       "jsons/SuperBobOmb.json",
                       "jsons/SuperKoopaDis_Feather.json",
                       "jsons/SuperKoopaDis_SwoopRedCape.json",
                       "jsons/SuperKoopaDis_SwoopYellowCape.json",
                       "jsons/SuperKoopasCUSTOM.json",
                       "jsons/sushi.json",
                       "jsons/switch_controlled_platform.json",
                       "jsons/SwooperDis.json",
                       "jsons/SwooperEerie.json",
                       "jsons/teleport_keyhole.json",
                       "jsons/ThrowAwayPokey.json",
                       "jsons/ThrowblockDis.json",
                       "jsons/thwomp_boss_custom.json",
                       "jsons/thwomp_dis_custom.json",
                       "jsons/thwomp_dis_custom_mini.json",
                       "jsons/thwomp_dis_pure.json",
                       "jsons/TimedCarrotLift.json",
                       "jsons/TimedOnOff.json",
                       "jsons/timed_lift_explode_four.json",
                       "jsons/timed_lift_explode_left.json",
                       "jsons/timed_lift_explode_one.json",
                       "jsons/timed_lift_explode_right.json",
                       "jsons/timed_lift_explode_three.json",
                       "jsons/timed_lift_explode_two.json",
                       "jsons/timed_lift_four.json",
                       "jsons/timed_lift_left.json",
                       "jsons/timed_lift_one.json",
                       "jsons/timed_lift_right.json",
                       "jsons/timed_lift_three.json",
                       "jsons/timed_lift_two.json",
                       "jsons/ToxicTimedLift.json",
                       "jsons/TrackerBlock.json",
                       "jsons/tracker_pipe.json",
                       "jsons/trackingflame.json",
                       "jsons/trackingflamespawner.json",
                       "jsons/trampoline.json",
                       "jsons/tryclyde.json",
                       "jsons/tryclyde_flame.json",
                       "jsons/UnderwaterBertha.json",
                       "jsons/upside_ninji.json",
                       "jsons/Urchin_Chase_Fire.json",
                       "jsons/vertical_bomb_shooter.json",
                       "jsons/volcano_lotus.json",
                       "jsons/water_drop.json",
                       "jsons/Wave_Horz_boostream.json",
                       "jsons/Wave_Vert_boostream.json",
                       "jsons/whimp.json",
                       "jsons/white_flame.json",
                       "jsons/winged_thwomp.json",
                       "jsons/XYFollowSprite.json",
                       "jsons/YI_Dandelion.json" };
    const Vector<String> filedata = names.view()
                                    .map([](const auto& name) {
                                        auto read_res = File::read_all(String{ name });
                                        HARD_ASSERT(read_res.is_ok(), "Failure reading file");
                                        return read_res.to_ok();
                                    })
                                    .collect<Vector<String>>();
    for (const auto& _ : state) {
        for (const auto& data : filedata) {
            auto res = JSON::Parser::parse(data.view());
            if (res.is_error()) { Printer::print("Error during parsing {}", res.to_error()); }
        }
    }
}
BENCHMARK(BM_PrintfStd);
BENCHMARK(BM_PrintfARLib);
BENCHMARK(BM_JSONParsing);
BENCHMARK_MAIN();